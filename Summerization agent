from agentpro.react_agent import ReactAgent
from agentpro.model import create_model
from agentpro.tools import QuickInternetTool, AresInternetTool

# ğŸ§  ReAct-style prompt for summarization
SUMMARIZATION_PROMPT = """
You are a summarization expert. Follow the ReAct pattern:
1. Think through what the user needs summarized.
2. Use QuickInternetTool or AresInternetTool to gather relevant data.
3. Produce a concise and clear summary when confident.

Use this format:
Thought: your reasoning
Action: {"action_type": "internet", "input": "query or topic"}
OR
Final Answer: your summary response
"""

# âœ… Summarization agent function
def run_summarization_agent(extracted_intent_summarization):
    if not extracted_intent_summarization:
        return "âŒ No intent passed to summarization agent."

    if extracted_intent_summarization.get("task") != "summarization":
        return "âš ï¸ Skipping Summarization Agent â€” task is not 'summarization'."

    query = extracted_intent_summarization.get("query")
    if not query:
        return "âŒ No query content found in extracted intent."

    # ğŸ§  Create agent with both internet tools
    agent = ReactAgent(
        tools=[QuickInternetTool(), AresInternetTool()],
        model=create_model(provider="openai"),
        custom_system_prompt=SUMMARIZATION_PROMPT
    )

    # ğŸ§  Run agent with input query
    result = agent.run(query)

    # âœ… Return final summary
    return result.final_answer if hasattr(result, "final_answer") else "âŒ No final answer."


# âœ… Optional: CLI test mode
if __name__ == "__main__":
    print("\nğŸ“š Running Summarization Agent...")

    try:
        summary = run_summarization_agent(extracted_intent_summary)
        print("\nğŸ“ Summary Output:")
        print(summary)
    except NameError:
        print("âŒ 'extracted_intent_summarization' not defined. Run from orchestrator or pass valid input.")
