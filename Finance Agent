from agentpro.react_agent import ReactAgent
from agentpro.model import create_model
from agentpro.tools import YFinanceTool

# ğŸ§  ReAct-style system prompt for finance
FINANCE_PROMPT = """
You are a financial research assistant. Use the ReAct method:
1. Break down the user's query and decide which financial data is needed.
2. Use the YFinanceTool to look up financial info.
3. Summarize the result clearly in human-friendly language.

Only use YFinanceTool for actions.

Format:
Thought: describe reasoning
Action: {"action_type": "yfinance", "input": "ticker symbol or query"}
OR
Final Answer: your complete financial insight
"""

# âœ… Main function to be called by orchestrator
def run_finance_agent(extracted_intent_finance):
    if not extracted_intent_finance:
        return "âŒ No intent passed to finance agent."

    if extracted_intent_finance.get("task") != "finance":
        return "â„¹ï¸ Skipping Finance Agent â€” task is not 'finance'."

    query = extracted_intent_finance.get("query")
    if not query:
        return "âŒ No query content found in extracted intent."

    # ğŸ§  Create ReAct Agent with YFinance tool
    agent = ReactAgent(
        tools=[YFinanceTool()],
        model=create_model(provider="openai"),
        custom_system_prompt=FINANCE_PROMPT
    )

    # ğŸ§  Run the agent on the input query
    result = agent.run(query)

    # âœ… Return final financial insight
    return result.final_answer if hasattr(result, "final_answer") else "âŒ No final answer returned."


# âœ… Optional: CLI test (only runs if file is executed directly)
if __name__ == "__main__":
    print("\nğŸ’¸ Running Finance Agent...")

    try:
        print("\nğŸ“Š Final Answer:")
        print(run_finance_agent(extracted_intent_finance))
    except NameError:
        print("âŒ 'extracted_intent_finance' not defined. Run from orchestrator or pass valid input.")
