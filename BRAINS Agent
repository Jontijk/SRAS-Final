from agentpro.react_agent import ReactAgent
from agentpro.model import create_model

#from router_agent import classify_query
#from presentation_agent import run_presentation_agent
#from calculate_agent import run_calculation_agent
#from finance_agent import run_finance_agent
#from summarization_agent import run_summarization_agent


# ğŸ§  ReAct prompt for brain decision
BRAIN_PROMPT = """
You are a smart brain agent that decides which specific research agent should be triggered based on a user query type.
You must reason and then respond with the exact agent to invoke:
- calculation
- presentation
- finance
- summarization
- text rewriting

Format:
Thought: explain the decision
Final Answer: name of the agent to use
"""

if __name__ == "__main__":
    print("\nğŸ§  Smart Brain Agent Active")

    # Step 1: Get user query
    user_query = input("\nğŸ“ Please enter your research query: ")

    # Step 2: Classify task using router logic
    extracted_intent = classify_query(user_query)  # returns {"query": ..., "task": ...}
    task_type = extracted_intent["task"]

    print(f"\nğŸ” Query classified as: {task_type}")

    # Step 3: Let the brain agent reason through the decision
    decision_prompt = f"""
Question: {extracted_intent['query']}

Query Type: {task_type}

Now decide the correct agent.
"""

    brain_agent = ReactAgent(
        tools=[],
        model=create_model(provider="openai"),
        custom_system_prompt=BRAIN_PROMPT
    )

    result = brain_agent.run(decision_prompt)
    decision = result.final_answer.strip().lower()

    print("\nğŸ§  Brain Decision:")
    print(decision)

    # Step 4: Trigger the corresponding agent
    if decision == "calculation":
        print("\nğŸš€ Launching Calculation Agent...")
        answer = run_calculation_agent(extracted_intent)
        print("\nğŸ§® Final Answer:")
        print(answer)

    elif decision == "presentation":
        print("\nğŸš€ Launching Presentation Agent...")
        answer = run_presentation_agent(extracted_intent)
        print("\nğŸ¥ Presentation Slides:")
        print(answer)

    elif decision == "finance":
        print("\nğŸš€ Launching Finance Agent...")
        answer = run_finance_agent(extracted_intent)
        print("\nğŸ’° Finance Info:")
        print(answer)

    elif decision == "summarization":
        print("\nğŸš€ Launching Summarization Agent...")
        answer = run_summarization_agent(extracted_intent)
        print("\nğŸ“ Summary:")
        print(answer)

    elif decision == "text rewriting":
        print("\nğŸš€ Launching Text Rewriter Agent...")
        answer = run_text_rewriter_agent(extracted_intent)
        print("\nğŸ“ Rephrased:")
        print(answer)
    else:
        print(f"âŒ Unknown agent: '{decision}' â€” no action taken.")
